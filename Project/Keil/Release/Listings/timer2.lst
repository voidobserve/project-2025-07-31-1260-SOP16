C51 COMPILER V9.60.7.0   TIMER2                                                            07/31/2025 08:44:44 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER2
OBJECT MODULE PLACED IN .\Release\Objects\timer2.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\timer2.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C) INC
                    -DIR(..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\timer2.lst) OBJECT(.\Rel
                    -ease\Objects\timer2.obj)

line level    source

   1          #include "timer2.h"
   2          #define TIMER2_PEROID_VAL (SYSCLK / 128 / 10000 - 1) // Âë®ÊúüÂÄº=Á≥ªÁªüÊó∂Èíü/ÂàÜÈ¢ë/È¢ëÁéá - 1
   3          
   4          // volatile u16 tmr2_cnt = 0;
   5          
   6          static volatile u16 pwm_duty_add_cnt; // Áî®‰∫éÊéßÂà∂pwmÂ¢ûÂä†ÁöÑÊó∂Èó¥ËÆ°Êï∞
   7          static volatile u16 pwm_duty_sub_cnt; // Áî®‰∫éÊéßÂà∂pwmÈÄíÂáèÁöÑÊó∂Èó¥ËÆ°Êï∞
   8          
   9          volatile bit flag_is_pwm_add_time_comes = 0; // Ê†áÂøó‰ΩçÔºåpwmÂç†Á©∫ÊØîÈÄíÂ¢ûÊó∂Èó¥Âà∞Êù•
  10          volatile bit flag_is_pwm_sub_time_comes = 0; // Ê†áÂøó‰ΩçÔºåpwmÂç†Á©∫ÊØîÈÄíÂáèÊó∂Èó¥Âà∞Êù•
  11          
  12          void timer2_config(void)
  13          {
  14   1          __EnableIRQ(TMR2_IRQn); // ‰ΩøËÉΩtimer2‰∏≠Êñ≠
  15   1          IE_EA = 1;              // ‰ΩøËÉΩÊÄª‰∏≠Êñ≠
  16   1      
  17   1          // ËÆæÁΩÆtimer2ÁöÑËÆ°Êï∞ÂäüËÉΩÔºåÈÖçÁΩÆ‰∏Ä‰∏™È¢ëÁéá‰∏∫1kHzÁöÑ‰∏≠Êñ≠
  18   1          TMR_ALLCON = TMR2_CNT_CLR(0x1);                               // Ê∏ÖÈô§ËÆ°Êï∞ÂÄº
  19   1          TMR2_PRH = TMR_PERIOD_VAL_H((TIMER2_PEROID_VAL >> 8) & 0xFF); // Âë®ÊúüÂÄº
  20   1          TMR2_PRL = TMR_PERIOD_VAL_L((TIMER2_PEROID_VAL >> 0) & 0xFF);
  21   1          TMR2_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);                          // ËÆ°Êï∞Á≠â‰∫éÂë®ÊúüÊó∂Â
             -ÖÅËÆ∏ÂèëÁîü‰∏≠Êñ≠
  22   1          TMR2_CONL = TMR_SOURCE_SEL(0x7) | TMR_PRESCALE_SEL(0x7) | TMR_MODE_SEL(0x1); // ÈÄâÊã©Á≥ªÁªüÊó∂ÈíüÔºå1
             -28ÂàÜÈ¢ëÔºåËÆ°Êï∞Ê®°Âºè
  23   1      }
  24          
  25          // ÂÆöÊó∂Âô® ‰∏≠Êñ≠ÊúçÂä°ÂáΩÊï∞
  26          void TIMR2_IRQHandler(void) interrupt TMR2_IRQn
  27          {
  28   1          // ËøõÂÖ•‰∏≠Êñ≠ËÆæÁΩÆIPÔºå‰∏çÂèØÂà†Èô§
  29   1          __IRQnIPnPush(TMR2_IRQn);
  30   1      
  31   1          // ---------------- Áî®Êà∑ÂáΩÊï∞Â§ÑÁêÜ -------------------
  32   1      
  33   1          // Âë®Êúü‰∏≠Êñ≠
  34   1          if (TMR2_CONH & TMR_PRD_PND(0x1)) // Á∫¶100usËß¶Âèë‰∏ÄÊ¨°‰∏≠Êñ≠
  35   1          {
  36   2              TMR2_CONH |= TMR_PRD_PND(0x1); // Ê∏ÖÈô§pending
  37   2      
  38   2              // tmr2_cnt++;
  39   2              // P13 = ~P13; // ÊµãËØï‰∏≠Êñ≠Ëß¶ÂèëÂë®Êúü
  40   2      
  41   2              pwm_duty_add_cnt++;
  42   2              pwm_duty_sub_cnt++;
  43   2      
  44   2              if (pwm_duty_sub_cnt >= 13) // 1300usÔºå1.3ms
  45   2              // if (pwm_duty_sub_cnt >= 50) 
  46   2              {
  47   3                  pwm_duty_sub_cnt = 0;
  48   3                  flag_is_pwm_sub_time_comes = 1;
  49   3              }
  50   2      
  51   2              // if (pwm_duty_add_cnt >= 133) // 13300us, 13.3ms
C51 COMPILER V9.60.7.0   TIMER2                                                            07/31/2025 08:44:44 PAGE 2   

  52   2              if (pwm_duty_add_cnt >= 13) // 
  53   2              {
  54   3                  pwm_duty_add_cnt = 0;
  55   3                  flag_is_pwm_add_time_comes = 1;
  56   3              }
  57   2          }
  58   1      
  59   1          // ÈÄÄÂá∫‰∏≠Êñ≠ËÆæÁΩÆIPÔºå‰∏çÂèØÂà†Èô§
  60   1          __IRQnIPnPop(TMR2_IRQn);
  61   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    130    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
